#!/usr/bin/env bash
history_json="$(dunstctl history)"
history_items="$(printf '%s' "$history_json" | jq -r '.data[0][] | .appname.data , (.timestamp.data | tostring) , .summary.data, .body.data | gsub("[\\n]"; "\\n")')"
iter=0

IFS='
'
while
  read -r application_name
  read -r notification_timestamp
  read -r notification_summary
  read -r notification_body
do
  iter=$((iter + 1))

  # option=$(printf '<span foreground="%s"><b>%s</b> <small>(%s)</small>:</span> \n <i>%s</i>|\n' "$fg" "$notification_summary" "$application_name" "$notification_body")
  option=$(echo "(box :orientation \"v\" :space-evenly \"false\" :class \"notify-container\"\n\t(label :xalign 0.01 :class \"notify-title\" :justify \"left\" :text \"$notification_summary ($application_name):\")\n\t(label :xalign 0.03 :class \"notify-content\" :wrap \"true\" :wrap-mode \"char\" :text \"$(echo $notification_body | sed 's/"/\\"/g')\")\n)\n")
  options="$options$option"
done <<EOF
$history_items
EOF
echo -e "(box :orientation \"v\" :spacing 0 :space-evenly \"false\"\n$options\n)" >$HOME/.config/qtile/assets/eww/notify/notify-list.txt
eww -c $HOME/.config/qtile/assets/eww open --toggle notify --screen 1
