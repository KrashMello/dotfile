#!/usr/bin/env bash

history_json="$(dunstctl history)"
history_items="$(printf '%s' "$history_json" | jq -r '.data[0][] | .appname.data , (.timestamp.data | tostring) , .summary.data, .body.data | gsub("[\\n]"; "\\n")')" # the gsub is to really ensure no escaped new lines in the data lead us to print new lines. New lines in data have to be escaped. (Because) Actual newlines are the field separator essential to the logic of the while loop below, and rofi further down.

iter=0

IFS='
'
while
  read -r application_name
  read -r notification_timestamp
  read -r notification_summary
  read -r notification_body
do
  iter=$((iter + 1))
  option=$(printf '"%s" (%s): %s ' "$notification_summary" "$application_name" "$notification_body")

  options="$options$option
"
done <<EOF
$history_items
EOF

options="$options"

result=$(printf '%s' "$options" | rofi -theme $HOME/.config/rofi/config/notify.rasi -dmenu -i)
